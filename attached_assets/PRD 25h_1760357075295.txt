üìù Product Requirements Document (PRD) - Sistema 25h
1. Introdu√ß√£o
1.1. Prop√≥sito
Este documento detalha os requisitos e especifica√ß√µes para o desenvolvimento do Sistema 25h (Frontend em NEXT.JS), alinhando as necessidades de neg√≥cio com o backend implementado no Supabase (Schema Prisma e Fun√ß√µes RPC/Edge Functions).

1.2. Foco da Implementa√ß√£o (Sprint Zero)
O foco desta fase √© a √°rea logada do Assinante e a Gest√£o de Assinatura (Onboarding, Upgrade, Pagamento), conforme as APIs definidas.

2. Vis√£o Geral do Produto e Dores Resolvidas
2.1. Usu√°rios
Assinante (Empresa): Usu√°rio logado que gerencia cobran√ßas.

Administrador 25h: Usu√°rio interno propriet√°rio do sistema 25h (painel administrativo).

2.2. Dores Resolvidas (Valor para o Assinante)
Dor Atual	Solu√ß√£o 25h	Benef√≠cio Central
Falta de Tempo	Automa√ß√£o do ciclo de cobran√ßa via Pix Autom√°tico.	+1 Hora no seu dia.
Inadimpl√™ncia/Atrito	Cobran√ßa sem fric√ß√£o via Pix Autom√°tico (1 clique).	Maior taxa de sucesso no pagamento.
Complexidade/Taxas	Concilia√ß√£o autom√°tica e taxas fixas, pagas apenas na liquida√ß√£o.	Mais Dinheiro no Bolso.

3. Requisitos da Experi√™ncia (UX) - Frontend
3.1. M√≥dulos do Assinante (NEXT.JS)
Todos os dados ser√£o acessados atrav√©s das tabelas do schema app_data, filtrados pelo assinante_id via RLS.

3.1.1. Dashboard
Vis√£o Geral: Informa√ß√µes sumarizadas (baseadas em ClienteCobranca e Cliente).

KPIs de Cobran√ßa: Quantidade e Valor de cobran√ßas Geradas (M√™s e Ano).

Faturamento: Faturamento Mensal e Anual.

Clientes: Contagem de Clientes Ativos (indAtivo = true em Cliente) e Inativos.

3.1.2. Clientes
Modelo de Dados: app_data.cliente

Cadastrar/Editar Cliente: Campos: nome, whatsapp, indAtivo (default true).

Inativar Cliente: Atualizar o campo indAtivo para false (Exclus√£o L√≥gica).

Lista de Clientes:

Filtros: Nome (Autocomplete), Situa√ß√£o (Ativo/Inativo), C√≥digo Cliente (a ser implementado).

3.1.3. Cobran√ßas
Modelo de Dados: app_data.cliente_cobranca

Funcionalidades:

Gest√£o de Cobran√ßas: CRUD (Criar, Editar, Excluir).

Status de Pagamento: Atualizar statusPagamento (e dthrPagamento se pago manualmente).

Lista de Cobran√ßas:

Filtros (Baseado em StatusCobranca enum): Cliente (Autocomplete), Situa√ß√£o Cobran√ßa (EM_ABERTO, PAGO, CANCELADO, FALHOU), Per√≠odo (M√™s Atual; √öltimos 3/6/12 Meses).

3.2. Gest√£o de Conta e Assinatura
3.2.1. Perfil do Assinante (Cadastro)
Modelo de Dados: app_data.assinante

Funcionalidade: Chamar public.atualizar_dados_assinante para salvar dados essenciais, especialmente os requeridos para pagamento de planos (e futura gera√ß√£o de Pix): nome, email, cpfCnpj, tipoPessoa, whatsapp.

Visualiza√ß√£o: Chamar public.obter_dados_assinante.

3.2.2. Gest√£o de Planos
Modelo de Dados: app_data.cfg_planos_assinatura

Funcionalidade: Listar planos dispon√≠veis (pagos) usando public.listar_planos_assinatura(p_incluir_gratuito: false).

Transi√ß√£o de Plano: Chamar public.criar_nova_assinatura para iniciar upgrade/renova√ß√£o.

4. Requisitos do Painel Administrativo (NEXT.JS)
O acesso √© restrito aos usu√°rios com a funcao = ADMIN.

4.1. Dashboard Administrativo
Vis√£o Global: KPIs de Assinantes Ativos/Inativos, e vis√£o consolidada de todas as cobran√ßas.

4.2. Assinantes (Gerenciamento)
Modelo de Dados: app_data.assinante e app_data.usuario

Funcionalidades: CRUD de Assinantes. Inativar (Exclus√£o L√≥gica) e Edi√ß√£o.

Requisito: Assinantes devem ter cpfCnpj preenchido (CNPJ √© obrigat√≥rio para empresas).

Associa√ß√£o de Plano: Associar, Fazer Upgrade e Downgrade (manipulando app_data.assinatura).

4.3. Planos (Configura√ß√£o)
Modelo de Dados: app_data.cfg_planos_assinatura

Funcionalidades: CRUD de planos.

Regra Plano FREE: indGratuito = true, valorMensal = 0, limiteClientesAtivos = 5 (usando limiteClientesAtivos como limite de Pix).

5. Detalhamento do Fluxo de Onboarding do Assinante (Baseado na API)
O fluxo √© conduzido pela fun√ß√£o public.processar_pos_login.

5.1. Etapa 1: Autentica√ß√£o e Verifica√ß√£o Inicial
A√ß√£o do Frontend	Chamada Backend (Supabase)	Tratamento no Frontend
Login/Signup	Supabase Auth (Email/Senha ou Google)	Obt√©m o JWT Token.
P√≥s-Login	public.processar_pos_login()	Verifica o status da resposta: OK, ERROR, ou SEM ASSINATURA.
Erro de Dados Faltantes	Retorno status: ERROR, code: USER_NOT_FOUND_MISSING_DATA	EXIBIR FORMUL√ÅRIO: Coletar nome e whatsapp. Chamar processar_pos_login(nome, whatsapp) novamente.
Cria√ß√£o Autom√°tica	(Backend faz) Cria assinante, usuario (com fun√ß√µes ADMIN e PROFISSIONAL), e assinatura gratuita (ind_gratuito: true).	Assinante √© direcionado para o Dashboard com a assinatura ATIVA.

Exportar para as Planilhas
5.2. Etapa 2: Redirecionamento e Tratamento da Assinatura
O frontend deve inspecionar o assinatura.status retornado por processar_pos_login.

Status Retornado	A√ß√£o Requerida do Frontend
OK + ATIVA	Redirecionar para Dashboard. (Isso ocorrer√° se for Plano FREE rec√©m-criado ou Pago ativo).
OK + AGUARDANDO_PAGAMENTO	Tela de Pagamento Pendente. Exibir dados da cobran√ßa em aberto e link de pagamento (linkPagamento em AssinaturaCobranca).
OK + SUSPENSA	Tela de Renova√ß√£o. Sugerir upgrade ou reativa√ß√£o do plano.
OK + CANCELADA ou SEM ASSINATURA	Tela de Escolha de Plano. Chamar public.listar_planos_assinatura(false).

Exportar para as Planilhas
5.3. Etapa 3: Upgrade de Plano (Pagamento)
Este fluxo √© obrigat√≥rio quando o usu√°rio decide sair do Plano FREE ou renovar um plano expirado.

A√ß√£o	Chamada Backend	Requisito/Observa√ß√£o
1. Escolha do Plano	public.listar_planos_assinatura(false)	Usu√°rio escolhe planoId e periodicidade.
2. Atualiza√ß√£o Cadastral	public.obter_dados_assinante seguido por public.atualizar_dados_assinante	OBRIGAT√ìRIO: O backend pode retornar erro INCOMPLETE_DATA se faltarem nome, cpfCnpj, tipoPessoa ou email antes de criar a assinatura paga.
3. Cria√ß√£o da Assinatura	public.criar_nova_assinatura(p_plano_id, p_periodicidade)	Retorna o cobranca_id. O status da nova assinatura ser√° AGUARDANDO_PAGAMENTO.
4. In√≠cio do Pagamento	Edge Function iniciar_pagto_assinante(cobranca_id, meio_pagamento)	meio_pagamento pode ser OPF_PIX_AUTOMATICO ou OPF_PIX_IMEDIATO. Retorna a paymentUrl do Gateway (Pluggy).
5. Redirecionamento	window.open(paymentUrl)	Redirecionar o cliente para o link de pagamento do Gateway.
6. Confirma√ß√£o	Polling com public.listar_assinaturas ou Supabase Realtime	Esperar que o status da assinatura mude para ATIVA (Webhooks do Gateway far√£o a atualiza√ß√£o autom√°tica no backend)