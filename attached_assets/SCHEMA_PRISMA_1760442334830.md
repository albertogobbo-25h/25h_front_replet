# Schema Prisma - 25h.com.br

Este documento apresenta o schema Prisma do banco de dados do sistema SaaS 25h.com.br, organizado por categorias funcionais.

## Visão Geral

O banco de dados está estruturado em schemas separados:
- **`app_data`**: Dados da aplicação (tabelas de negócio)
- **`app_internal`**: Funções internas (lógica de negócio)
- **`public`**: Funções expostas via API
- **`auth`**: Autenticação (Supabase Auth)

## Categorias Funcionais

### 1. Onboarding e Gestão de Assinatura

#### Assinante
```prisma
model Assinante {
  id            String    @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  nome          String
  nomeFantasia  String?   @map("nome_fantasia")
  rua           String?
  numero        String?
  complemento   String?
  bairro        String?
  cidade        String?
  uf            String?   @db.Char(2)
  cep           String?   @db.VarChar
  cpfCnpj       String?   @unique @map("cpf_cnpj") @db.VarChar
  tipoPessoa    TipoPessoa? @map("tipo_pessoa")
  email         String?
  whatsapp      String
  criadoPor     String    @map("criado_por") @db.Uuid
  criadoEm      DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm  DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  usuarios              Usuario[]
  assinaturas           Assinatura[]
  assinaturaCobrancas   AssinaturaCobranca[]
  clientes              Cliente[]
  clientesAssinaturas   ClienteAssinatura[]
  clientesCobrancas     ClienteCobranca[]
  eventos               Evento[]
  eventosClientes       EventoCliente[]
  eventosFormatos       EventoFormato[]
  eventosLocais         EventoLocal[]
  eventosRecorrentes    EventoRecorrente[]
  eventosRecorrentesClientes EventoRecorrenteCliente[]
  profissionais         Profissional[]
  clientesPlanos        ClientePlano[]
  gatewayAssinantePagadores GatewayAssinantePagador[]
  gatewayAssinanteRecebedores GatewayAssinanteRecebedor[]

  @@map("assinante")
  @@schema("app_data")
}
```

#### Usuário
```prisma
model Usuario {
  id                String    @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  assinanteId       String    @map("assinante_id") @db.Uuid
  nome              String
  nomeVisualizacao  String?   @map("nome_visualizacao")
  whatsapp          String
  dataNascimento    DateTime? @map("data_nascimento") @db.Date
  indAtivo          Boolean   @default(true) @map("ind_ativo")
  indAdmin          Boolean   @default(false) @map("ind_admin")
  verTutoriais      Boolean   @default(true) @map("ver_tutoriais")
  verBoasVindas     Boolean   @default(true) @map("ver_boas_vindas")
  verNotificacoes   Boolean   @default(true) @map("ver_notificacoes")
  criadoPor         String    @map("criado_por") @db.Uuid
  criadoEm          DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm      DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  assinante         Assinante @relation(fields: [assinanteId], references: [id])
  funcoes           UsuarioFuncao[]
  profissionais     Profissional[]

  @@map("usuario")
  @@schema("app_data")
}
```

#### Função do Usuário
```prisma
model UsuarioFuncao {
  usuarioId String    @map("usuario_id") @db.Uuid
  funcao    Funcoes
  criadoPor String    @map("criado_por") @db.Uuid
  criadoEm  DateTime  @default(now()) @map("criado_em") @db.Timestamptz

  // Relacionamentos
  usuario   Usuario   @relation(fields: [usuarioId], references: [id])

  @@id([usuarioId, funcao])
  @@map("usuario_funcao")
  @@schema("app_data")
}
```

#### Plano de Assinatura
```prisma
model CfgPlanosAssinatura {
  id                    Int       @id @default(autoincrement()) @db.SmallInt
  titulo                String
  descricao             String?
  indAtivo              Boolean?  @default(true) @map("ind_ativo")
  features              Json?     @db.JsonB
  limiteClientesAtivos  Int?      @map("limite_clientes_ativos") @db.SmallInt
  valorMensal           Decimal   @map("valor_mensal") @db.Decimal(10,2)
  valorAnual            Decimal?  @map("valor_anual") @db.Decimal(10,2)
  valorMensalComDesconto Decimal? @map("valor_mensal_com_desconto") @db.Decimal(10,2)
  valorAnualComDesconto Decimal? @map("valor_anual_com_desconto") @db.Decimal(10,2)
  diasDegustacao        Int?      @map("dias_degustacao") @db.SmallInt
  indGratuito           Boolean   @default(false) @map("ind_gratuito")
  criadoPor             String    @map("criado_por") @db.Uuid
  criadoEm              DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm          DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  assinaturas Assinatura[]

  @@map("cfg_planos_assinatura")
  @@schema("app_data")
}
```

#### Assinatura
```prisma
model Assinatura {
  id                    String                    @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  assinanteId           String                    @map("assinante_id") @db.Uuid
  planoId               Int                       @map("plano_id") @db.SmallInt
  dataInicio            DateTime                  @default(now()) @map("data_inicio") @db.Date
  dataValidade          DateTime                  @map("data_validade") @db.Date
  dataCancelamento      DateTime?                 @map("data_cancelamento") @db.Date
  idAssinaturaGateway   String?                   @map("id_assinatura_gateway")
  observacao            String?
  meioPagamento         MeioPagamento?            @map("meio_pagamento")
  status                StatusAssinatura          @default(AGUARDANDO_PAGAMENTO)
  periodicidade         AssinaturaPeriodicidade   @default(MENSAL)
  criadoPor             String                    @map("criado_por") @db.Uuid
  criadoEm              DateTime                  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm          DateTime                  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  assinante             Assinante                 @relation(fields: [assinanteId], references: [id])
  plano                 CfgPlanosAssinatura       @relation(fields: [planoId], references: [id])
  cobrancas             AssinaturaCobranca[]
  pluggyPaymentRequests PluggyPaymentRequest[]
  recebimentosPosCancelamento RecebimentoPosCancelamento[]

  @@map("assinatura")
  @@schema("app_data")
}
```

#### Cobrança de Assinatura
```prisma
model AssinaturaCobranca {
  id                String            @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  assinaturaId      String            @map("assinatura_id") @db.Uuid
  assinanteId       String            @map("assinante_id") @db.Uuid
  valor             Decimal           @db.Decimal(10,2)
  dataEmissao       DateTime          @default(now()) @map("data_emissao") @db.Date
  dataVencimento    DateTime          @map("data_vencimento") @db.Date
  dthrPagamento     DateTime?         @map("dthr_pagamento") @db.Timestamptz
  linkPagamento     String?           @map("link_pagamento")
  idCobrancaGateway String?           @map("id_cobranca_gateway")
  observacao        String?
  statusPagamento   StatusCobranca    @default(EM_ABERTO) @map("status_pagamento")
  meioPagamento     MeioPagamento?    @map("meio_pagamento")
  statusGateway     String?           @map("status_gateway")
  endToEndIdPix     String?           @map("end_to_end_id_pix")
  criadoPor         String            @map("criado_por") @db.Uuid
  criadoEm          DateTime          @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm      DateTime          @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  assinatura        Assinatura        @relation(fields: [assinaturaId], references: [id])
  assinante         Assinante         @relation(fields: [assinanteId], references: [id])
  pluggyPaymentRequests PluggyPaymentRequest[]
  recebimentosPosCancelamento RecebimentoPosCancelamento[]

  @@map("assinatura_cobranca")
  @@schema("app_data")
}
```

### 2. Gestão de Cliente Final

#### Cliente
```prisma
model Cliente {
  id                String    @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  nome              String
  nomeVisualizacao  String?   @map("nome_visualizacao")
  whatsapp          String?
  assinanteId       String    @map("assinante_id") @db.Uuid
  observacao        String?
  indAtivo          Boolean   @default(true) @map("ind_ativo")
  criadoPor         String?   @map("criado_por") @db.Uuid
  criadoEm          DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm      DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  assinante         Assinante         @relation(fields: [assinanteId], references: [id])
  assinaturas       ClienteAssinatura[]
  cobrancas         ClienteCobranca[]
  eventos           EventoCliente[]
  eventosRecorrentes EventoRecorrenteCliente[]

  @@map("cliente")
  @@schema("app_data")
}
```

#### Plano do Cliente
```prisma
model ClientePlano {
  id            String    @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  assinanteId   String    @map("assinante_id") @db.Uuid
  nome          String
  descricao     String?
  tipo          String    // 'mensalidade_fixa', 'pacote', 'por_atendimento', 'periodico'
  valorMensal   Decimal?  @map("valor_mensal") @db.Decimal(10,2)
  valorAtendimento Decimal? @map("valor_atendimento") @db.Decimal(10,2)
  qtdAtendimentos Int?    @map("qtd_atendimentos")
  periodicidade String?   // 'mensal', 'trimestral', 'semestral', 'anual'
  ativo         Boolean?  @default(true)
  criadoPor     String?   @map("criado_por") @db.Uuid
  criadoEm      DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm  DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  assinante     Assinante         @relation(fields: [assinanteId], references: [id])
  assinaturas   ClienteAssinatura[]
  cobrancas     ClienteCobranca[]

  @@map("cliente_plano")
  @@schema("app_data")
}
```

#### Assinatura do Cliente
```prisma
model ClienteAssinatura {
  id                String    @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  assinanteId       String    @map("assinante_id") @db.Uuid
  clienteId         String    @map("cliente_id") @db.Uuid
  clientePlanoId    String    @map("cliente_plano_id") @db.Uuid
  inicio            DateTime  @db.Date
  fim               DateTime? @db.Date
  status            String    // 'ativa', 'suspensa', 'cancelada', 'encerrada'
  saldoAtendimentos Int?      @map("saldo_atendimentos")
  saldoMonetario    Decimal?  @map("saldo_monetario") @db.Decimal(10,2)
  idAssinaturaGateway String? @map("id_assinatura_gateway")
  criadoPor         String?   @map("criado_por") @db.Uuid
  criadoEm          DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm      DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  assinante         Assinante         @relation(fields: [assinanteId], references: [id])
  cliente           Cliente           @relation(fields: [clienteId], references: [id])
  clientePlano      ClientePlano      @relation(fields: [clientePlanoId], references: [id])
  cobrancas         ClienteCobranca[]

  @@map("cliente_assinatura")
  @@schema("app_data")
}
```

#### Cobrança do Cliente
```prisma
model ClienteCobranca {
  id                    String            @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  assinanteId           String            @map("assinante_id") @db.Uuid
  clienteId             String            @map("cliente_id") @db.Uuid
  referenciaMes         DateTime?         @map("referencia_mes") @db.Date
  descricao             String
  valorTotal            Decimal           @map("valor_total") @db.Decimal(10,2)
  statusPagamento       StatusCobranca    @default(EM_ABERTO) @map("status_pagamento")
  urlPagamento          String?           @map("url_pagamento")
  meioPagamento         String?           @map("meio_pagamento")
  dataEmissao           DateTime          @default(now()) @map("data_emissao") @db.Date
  dataVencimento        DateTime          @map("data_vencimento") @db.Date
  dthrPagamento         DateTime?         @map("dthr_pagamento") @db.Timestamptz
  idCobrancaGateway     String?           @map("id_cobranca_gateway")
  clienteAssinaturaId   String            @map("cliente_assinatura_id") @db.Uuid
  clientePlanoId        String            @map("cliente_plano_id") @db.Uuid
  criadoPor             String?           @map("criado_por") @db.Uuid
  criadoEm              DateTime          @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm          DateTime          @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  assinante             Assinante         @relation(fields: [assinanteId], references: [id])
  cliente               Cliente           @relation(fields: [clienteId], references: [id])
  clienteAssinatura     ClienteAssinatura @relation(fields: [clienteAssinaturaId], references: [id])
  clientePlano          ClientePlano      @relation(fields: [clientePlanoId], references: [id])
  eventos               EventoCliente[]

  @@map("cliente_cobranca")
  @@schema("app_data")
}
```

### 3. Gestão de Agendamentos

#### Profissional
```prisma
model Profissional {
  id                String    @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  nome              String
  nomeVisualizacao  String?   @map("nome_visualizacao")
  usuarioId         String    @map("usuario_id") @db.Uuid
  assinanteId       String    @map("assinante_id") @db.Uuid
  whatsapp          String?
  criadoPor         String?   @map("criado_por") @db.Uuid
  criadoEm          DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm      DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  usuario           Usuario           @relation(fields: [usuarioId], references: [id])
  assinante         Assinante         @relation(fields: [assinanteId], references: [id])
  eventos           Evento[]
  eventosRecorrentes EventoRecorrente[]

  @@map("profissional")
  @@schema("app_data")
}
```

#### Formato de Evento
```prisma
model EventoFormato {
  id            BigInt    @id @default(autoincrement()) @db.BigInt
  nome          String
  assinanteId   String    @map("assinante_id") @db.Uuid
  corFundo      String    @map("cor_fundo")
  corTexto      String    @map("cor_texto")
  duracao       String    @db.Interval
  maxClientes   Int       @map("max_clientes")
  valorPadrao   Decimal?  @map("valor_padrao") @db.Decimal(10,2)
  userCreator   String?   @map("user_creator") @db.Uuid
  criadoEm      DateTime  @default(now()) @map("criado_em") @db.Timestamp
  modificadoEm  DateTime  @default(now()) @map("modificado_em") @db.Timestamp

  // Relacionamentos
  assinante         Assinante         @relation(fields: [assinanteId], references: [id])
  eventos           Evento[]
  eventosRecorrentes EventoRecorrente[]

  @@map("evento_formato")
  @@schema("app_data")
}
```

#### Local de Evento
```prisma
model EventoLocal {
  id            BigInt    @id @default(autoincrement()) @db.BigInt
  assinanteId   String    @map("assinante_id") @db.Uuid
  nome          String
  endereco      String?
  indPadrao     Boolean   @default(false) @map("ind_padrao")
  indAtivo      Boolean   @default(true) @map("ind_ativo")
  userCreator   String?   @map("user_creator") @db.Uuid
  criadoEm      DateTime  @default(now()) @map("criado_em") @db.Timestamp
  modificadoEm  DateTime  @default(now()) @map("modificado_em") @db.Timestamp

  // Relacionamentos
  assinante         Assinante         @relation(fields: [assinanteId], references: [id])
  eventos           Evento[]
  eventosRecorrentes EventoRecorrente[]

  @@map("evento_local")
  @@schema("app_data")
}
```

#### Evento
```prisma
model Evento {
  id                    BigInt    @id @default(autoincrement()) @db.BigInt
  assinanteId           String    @map("assinante_id") @db.Uuid
  profissionalId        String    @map("profissional_id") @db.Uuid
  eventoFormatoId       BigInt    @map("evento_formato_id") @db.BigInt
  eventoLocalId         BigInt    @map("evento_local_id") @db.BigInt
  dataHoraInicio        DateTime  @map("data_hora_inicio") @db.Timestamp
  dataHoraFim           DateTime  @map("data_hora_fim") @db.Timestamp
  observacao            String?
  corFundo              String?   @map("cor_fundo")
  corTexto              String?   @map("cor_texto")
  eventoRecorrenteId    BigInt?   @map("evento_recorrente_id") @db.BigInt
  userCreator           String?   @map("user_creator") @db.Uuid
  criadoEm              DateTime  @default(now()) @map("criado_em") @db.Timestamp
  modificadoEm          DateTime  @default(now()) @map("modificado_em") @db.Timestamp

  // Relacionamentos
  assinante             Assinante             @relation(fields: [assinanteId], references: [id])
  profissional          Profissional          @relation(fields: [profissionalId], references: [id])
  eventoFormato         EventoFormato         @relation(fields: [eventoFormatoId], references: [id])
  eventoLocal           EventoLocal           @relation(fields: [eventoLocalId], references: [id])
  eventoRecorrente      EventoRecorrente?     @relation(fields: [eventoRecorrenteId], references: [id])
  clientes              EventoCliente[]

  @@map("evento")
  @@schema("app_data")
}
```

#### Cliente do Evento
```prisma
model EventoCliente {
  eventoId          BigInt                    @map("evento_id") @db.BigInt
  clienteId         String                    @map("cliente_id") @db.Uuid
  assinanteId       String                    @map("assinante_id") @db.Uuid
  cobrancaId        String?                   @map("cobranca_id") @db.Uuid
  valor             Decimal?                  @db.Decimal(10,2)
  observacao        String?
  statusEvento      StatusEvento             @default(NORMAL) @map("status_evento")
  statusPagamento   StatusPagamentoEvento    @default(EM_ABERTO) @map("status_pagamento")
  userCreator       String?                  @map("user_creator") @db.Uuid
  criadoEm          DateTime                 @default(now()) @map("criado_em") @db.Timestamp
  modificadoEm      DateTime                 @default(now()) @map("modificado_em") @db.Timestamp

  // Relacionamentos
  evento            Evento                   @relation(fields: [eventoId], references: [id])
  cliente           Cliente                  @relation(fields: [clienteId], references: [id])
  assinante         Assinante                @relation(fields: [assinanteId], references: [id])
  cobranca          ClienteCobranca?         @relation(fields: [cobrancaId], references: [id])

  @@id([eventoId, clienteId])
  @@map("evento_cliente")
  @@schema("app_data")
}
```

#### Evento Recorrente
```prisma
model EventoRecorrente {
  id                BigInt    @id @default(autoincrement()) @db.BigInt
  eventoFormatoId   BigInt    @map("evento_formato_id") @db.BigInt
  profissionalId    String    @map("profissional_id") @db.Uuid
  eventoLocalId     BigInt?   @map("evento_local_id") @db.BigInt
  assinanteId       String    @map("assinante_id") @db.Uuid
  diaSemana         Int       @map("dia_semana")
  horaInicio        DateTime  @map("hora_inicio") @db.Time
  duracao           String    @db.Interval
  dataInicio        DateTime  @map("data_inicio") @db.Date
  dataFim           DateTime? @map("data_fim") @db.Date
  corFundo          String    @map("cor_fundo")
  corTexto          String    @map("cor_texto")
  userCreator       String?   @map("user_creator") @db.Uuid
  criadoEm          DateTime  @default(now()) @map("criado_em") @db.Timestamp
  modificadoEm      DateTime  @default(now()) @map("modificado_em") @db.Timestamp

  // Relacionamentos
  eventoFormato     EventoFormato            @relation(fields: [eventoFormatoId], references: [id])
  profissional      Profissional             @relation(fields: [profissionalId], references: [id])
  eventoLocal       EventoLocal?             @relation(fields: [eventoLocalId], references: [id])
  assinante         Assinante                @relation(fields: [assinanteId], references: [id])
  eventos           Evento[]
  clientes          EventoRecorrenteCliente[]

  @@map("evento_recorrente")
  @@schema("app_data")
}
```

#### Cliente do Evento Recorrente
```prisma
model EventoRecorrenteCliente {
  eventoRecorrenteId BigInt    @map("evento_recorrente_id") @db.BigInt
  clienteId          String    @map("cliente_id") @db.Uuid
  assinanteId        String    @map("assinante_id") @db.Uuid
  valor              Decimal?  @db.Decimal(10,2)
  userCreator        String?   @map("user_creator") @db.Uuid
  criadoEm           DateTime  @default(now()) @map("criado_em") @db.Timestamp
  modificadoEm       DateTime  @default(now()) @map("modificado_em") @db.Timestamp

  // Relacionamentos
  eventoRecorrente   EventoRecorrente        @relation(fields: [eventoRecorrenteId], references: [id])
  cliente            Cliente                 @relation(fields: [clienteId], references: [id])
  assinante          Assinante               @relation(fields: [assinanteId], references: [id])

  @@id([eventoRecorrenteId, clienteId])
  @@map("evento_recorrente_cliente")
  @@schema("app_data")
}
```

### 4. Configuração de Gateways de Pagamento

#### Gateway
```prisma
model Gateway {
  id            String    @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  nome          String
  tipo          String?
  criadoPor     String?   @map("criado_por") @db.Uuid
  criadoEm      DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm  DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  saasRecebedor         GatewaySaasRecebedor?
  assinanteRecebedores  GatewayAssinanteRecebedor[]
  assinantePagadores    GatewayAssinantePagador[]

  @@map("gateway")
  @@schema("app_data")
}
```

#### Gateway SaaS Recebedor
```prisma
model GatewaySaasRecebedor {
  gatewayId         String    @id @map("gateway_id") @db.Uuid
  idRecebedorGateway String   @map("id_recebedor_gateway")
  banco             String?
  criadoPor         String?   @map("criado_por") @db.Uuid
  criadoEm          DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm      DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  gateway           Gateway   @relation(fields: [gatewayId], references: [id])

  @@map("gateway_saas_recebedor")
  @@schema("app_data")
}
```

#### Gateway Assinante Recebedor
```prisma
model GatewayAssinanteRecebedor {
  id                String    @id @default(dbgenerated("gen_uuid_v7()")) @db.Uuid
  gatewayId         String    @map("gateway_id") @db.Uuid
  assinanteId       String    @map("assinante_id") @db.Uuid
  idRecebedorGateway String   @map("id_recebedor_gateway")
  banco             String?
  agencia           String?
  conta             String?
  criadoPor         String?   @map("criado_por") @db.Uuid
  criadoEm          DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm      DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  gateway           Gateway   @relation(fields: [gatewayId], references: [id])
  assinante         Assinante @relation(fields: [assinanteId], references: [id])

  @@map("gateway_assinante_recebedor")
  @@schema("app_data")
}
```

#### Gateway Assinante Pagador
```prisma
model GatewayAssinantePagador {
  gatewayId         String    @id @map("gateway_id") @db.Uuid
  assinanteId       String    @id @map("assinante_id") @db.Uuid
  idPagadorGateway  String    @map("id_pagador_gateway")
  banco             String?
  criadoPor         String?   @map("criado_por") @db.Uuid
  criadoEm          DateTime  @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm      DateTime  @default(now()) @map("modificado_em") @db.Timestamptz

  // Relacionamentos
  gateway           Gateway   @relation(fields: [gatewayId], references: [id])
  assinante         Assinante @relation(fields: [assinanteId], references: [id])

  @@id([gatewayId, assinanteId])
  @@map("gateway_assinante_pagador")
  @@schema("app_data")
}
```

### 5. Sistema de Integração e Logs

#### Parâmetros de Configuração
```prisma
model CfgParametros {
  chave       String    @id
  valor       String
  descricao   String?
  categoria   String?   @default("GERAL")
  criadoPor   String?   @map("criado_por") @db.Uuid
  criadoEm    DateTime? @default(now()) @map("criado_em") @db.Timestamptz
  modificadoEm DateTime? @default(now()) @map("modificado_em") @db.Timestamptz

  @@map("cfg_parametros")
  @@schema("app_data")
}
```

#### Pluggy Payment Request
```prisma
model PluggyPaymentRequest {
  id                    BigInt              @id @default(autoincrement()) @db.BigInt
  paymentRequestId      String              @unique @map("payment_request_id")
  meioPagamento         MeioPagamento       @map("meio_pagamento")
  recebedor             TipoRecebedor       @map("recebedor")
  assinaturaId          String?             @map("assinatura_id") @db.Uuid
  assinaturaCobrancaId  String?             @map("assinatura_cobranca_id") @db.Uuid
  clienteAssinaturaId   String?             @map("cliente_assinatura_id") @db.Uuid
  clienteCobrancaId     String?             @map("cliente_cobranca_id") @db.Uuid
  statusRequisicao      String?             @map("status_requisicao")
  createdAt             DateTime            @default(now()) @map("created_at") @db.Timestamptz
  updatedAt             DateTime            @default(now()) @map("updated_at") @db.Timestamptz

  // Relacionamentos
  assinatura            Assinatura?         @relation(fields: [assinaturaId], references: [id])
  assinaturaCobranca    AssinaturaCobranca? @relation(fields: [assinaturaCobrancaId], references: [id])

  @@map("pluggy_payment_request")
  @@schema("app_data")
}
```

#### Pluggy Event Log
```prisma
model PluggyEventLog {
  id                BigInt    @id @default(autoincrement()) @db.BigInt
  eventId           String    @unique @map("event_id")
  eventType         String    @map("event_type")
  paymentRequestId  String    @map("payment_request_id")
  payload           Json      @db.JsonB
  processedAt       DateTime  @default(now()) @map("processed_at") @db.Timestamptz

  @@map("pluggy_event_log")
  @@schema("app_data")
}
```

#### Recebimento Pós Cancelamento
```prisma
model RecebimentoPosCancelamento {
  id                    BigInt    @id @default(autoincrement()) @db.BigInt
  assinaturaId          String    @map("assinatura_id") @db.Uuid
  cobrancaId            String    @unique @map("cobranca_id") @db.Uuid
  valorRecebido         Decimal   @map("valor_recebido") @db.Decimal(10,2)
  dataRecebimento       DateTime  @map("data_recebimento") @db.Timestamptz
  statusResolucao       String    @default("PENDENTE") @map("status_resolucao")
  formaResolucao        String?   @map("forma_resolucao")
  dataResolucao         DateTime? @map("data_resolucao") @db.Timestamptz
  responsavelResolucao  String?   @map("responsavel_resolucao") @db.Uuid
  observacao            String?
  criadoEm              DateTime  @default(now()) @map("criado_em") @db.Timestamptz

  // Relacionamentos
  assinatura            Assinatura          @relation(fields: [assinaturaId], references: [id])
  cobranca              AssinaturaCobranca  @relation(fields: [cobrancaId], references: [id])

  @@map("recebimento_pos_cancelamento")
  @@schema("app_data")
}
```

## Enums

```prisma
enum TipoPessoa {
  FISICA
  JURIDICA
}

enum Funcoes {
  ADMIN
  PROFISSIONAL
  CLIENTE
}

enum StatusAssinatura {
  ATIVA
  AGUARDANDO_PAGAMENTO
  CANCELADA
  SUSPENSA
  CANCELAMENTO_SOLICITADO
}

enum AssinaturaPeriodicidade {
  MENSAL
  ANUAL
}

enum StatusCobranca {
  EM_ABERTO
  PAGO
  CANCELADO
  FALHOU
}

enum MeioPagamento {
  OPF_PIX_IMEDIATO
  OPF_PIX_AUTOMATICO
}

enum StatusEvento {
  NORMAL
  CANCELADO
  CLIENTE_FALTOU
}

enum StatusPagamentoEvento {
  EM_ABERTO
  PAGO
  CORTESIA
  REPOSICAO
  CANCELADA
  MENSALIDADE_FIXA
}

enum TipoRecebedor {
  SAAS
  ASSINANTE
}
```

## Observações Importantes

### Estratégias de Identificação
- **Tabelas principais**: `BIGINT IDENTITY` para máxima performance (eventos, assinaturas, clientes)
- **Tabelas de relacionamento**: Chave primária composta para integridade (evento_cliente, evento_recorrente_cliente)
- **Tabelas de configuração**: `UUID` com `gen_uuid_v7()` para ordenabilidade e APIs externas

### Tipos de Dados Padronizados
- **Instantes**: `TIMESTAMPTZ` (com fuso horário)
- **Datas lógicas**: `DATE` (sem horário)
- **Valores monetários**: `NUMERIC(10,2)` ou `NUMERIC(12,2)` conforme contexto
- **Textos**: `TEXT` para campos longos, `VARCHAR(n)` para campos limitados

### Auditoria
- Colunas padronizadas (`criado_por`, `criado_em`, `modificado_em`)
- RLS ativo em todas as tabelas para isolamento por `assinante_id`

### Multi-tenancy
- Todos os dados são filtrados por `assinante_id`
- RLS garante isolamento automático via `app_internal.current_assinante_id()`
- Contexto do tenant obtido via consulta ao banco (mais confiável que JWT claims)
